<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
  <head>
    <title>AEM Authoring Config Helper</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
      function getGithubUrlInfo() {
        const githubUrlElement = document.getElementById('inputGithubRepoUrl');
        const match = githubUrlElement.value.match(/github\.com\/([a-zA-Z0-9-]+)\/([a-zA-Z0-9-._]+)/);

        return match;
      }

      function getAEMAuthorUrl() {
        const AEMAuthorUrlElement = document.getElementById('inputAEMAuthorUrl');
        const match = AEMAuthorUrlElement.value.match(/^(https?:\/\/[^\/]+)\/?/i);

        if (match) {
          const AEMAuthorUrl = match[1];
          return AEMAuthorUrl;
        } else {
          return '';
        }
      }

      function showInfo() {
        const formElement = document.getElementById('form');
        formElement.classList.add('was-validated');

        const GithubUrlMatch = getGithubUrlInfo();

        if(!GithubUrlMatch) {
          return;
        }

        const username = GithubUrlMatch[1];
        const repositoryName = GithubUrlMatch[2];

        const AEMAuthorUrl = getAEMAuthorUrl();

        if(!AEMAuthorUrl) {
          return;
        }

        const myModal = new bootstrap.Modal('#result', {
          keyboard: false
        });

        document.getElementById('readonlyInputGithubRepoUrl').value = `https://github.com/${username}/${repositoryName}`;
        document.getElementById('readonlyInputMountpointsUrl').value = `${AEMAuthorUrl}/bin/franklin.delivery/${username}/${repositoryName}/main`;
        document.getElementById('fstabUrl').href = `https://github.com/${username}/${repositoryName}/blob/main/fstab.yaml`;

        myModal.show();
      }

      function copyToClipboard(id) {
        const copyText = document.getElementById(id);

        // Use the Clipboard API to write the text
        navigator.clipboard.writeText(copyText.value)
          .then(() => {
          })
          .catch(err => {
            console.error('Failed to copy text: ', err);
          });
      }
    </script>
  </head>
  <body>
    <main>
      <div class="container py-5">
        <div class="modal" id="result" tabindex="-1">
          <div class="modal-dialog modal-xl">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Result</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div>
                  <label for="readonlyInputGithubRepoUrl" class="form-label">Github Repository Url</label>
                  <div class="input-group mb-3">
                    <input id="readonlyInputGithubRepoUrl" class="form-control" type="text" readonly>
                    <button id="copyBtn" class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('readonlyInputGithubRepoUrl')">Copy</button>
                  </div>
                </div>
                <div>
                  <label for="readonlyInputMountpointsUrl" class="form-label">mountpoints url in <a id="fstabUrl" href="#" target="_blank">fstab.yaml</a></label>
                  <div class="input-group mb-3">
                    <input id="readonlyInputMountpointsUrl" class="form-control" type="text" readonly>
                    <button id="copyBtn" class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('readonlyInputMountpointsUrl')">Copy</button>
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>

        <div id="form" class="needs-validation">
          <div class="mb-3">
            <label for="inputGithubRepoUrl" class="form-label">Github Respository URL</label>
            <div class="input-group has-validation">
              <input type="text" class="form-control" id="inputGithubRepoUrl" placeholder="https://github.com/adobe-rnd/aem-boilerplate-xwalk" required>
              <div class="invalid-feedback">
                Please enter a github repository url
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label for="inputAEMAuthorUrl" class="form-label">AEM Author URL</label>
            <div class="input-group has-validation">
              <input type="text" class="form-control" id="inputAEMAuthorUrl" placeholder="https://author-p1234-e12345.adobeaemcloud.com" required>
              <div class="invalid-feedback">
                Please enter an AEM Author url
              </div>
            </div>
          </div>
          <button class="btn btn-primary" onclick="showInfo()">Generate</button>
        </div>
      </div>
    </main>
  </body>
</html>